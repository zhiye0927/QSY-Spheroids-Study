---
title: "Shaping strategies and standardisation of faceted spheroids from Qianshangying (North China)"
institute:
  - fosg:
      name: Formatting Open Science Group
      address: 23 Science Street, Eureka, Mississippi, USA
  - fop: Federation of Planets
title-block-published: "Last updated"  
date: now
date-format: long
format: html
execute:
  echo: true
  warning: false
  message: false
  comment: "#>"
  fig-dpi: 600
bibliography: references.bib
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
editor_options: 
  chunk_output_type: console
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The actual document text starts here: -->

```{r setup, include=FALSE}

library(data.table)
library(NISTunits)
library(circular)
library(ggpubr)
library(ggalt)
library(ggplot2)
library(stringr)
library(ggtern)
library(dplyr)
library(here)
source(here('analysis/paper/scripts/McPherron_2018.r'))
source(here('analysis/paper/scripts/get_coordinates.r'))
source(here('analysis/paper/scripts/vector_stats.r'))
```

# Introduction

The pursuit of perfect geometric forms—particularly the ideal sphere—appears to transcend time, persisting from antiquity to the present. Spheroids may be kind of stone artifacts that embody this aspiration toward geometric perfection, reflecting Paleolithic humans’ spatial and navigational cognition, and their grasp of abstract concepts such as ''3D symmetry'' ([@Muller2023; @clark1955; @wynn2002]). This cognitive awareness may have emerged even earlier than the production of handaxes ([@beyene2013; @shipton2019; @white2018]). Consequently, the study of spheroids—including their manufacturing techniques and morphological characteristics—has become a key issue in interpreting early human technological behaviors and cognitive capacities ([@cabanès2022]). [BM: this paragraph seems too poetic and abstract for a scholarly journal article. I think it will be better to open the paper with your sentence below that starts with 'Spheroids are a widely distributed type...']

Early descriptions of spheroids were provided by [@clark1955] and [@kleindienst1962], and [@leakey1971] later formally introduced the term spheroid, alongside polyhedron and bola, in his classification of the Developed Oldowan. Leakey’s definition of spheroids remains a widely cited typological standard: spheroids are rounded lithic objects whose entire surface is covered with flake scars, while subspheroids are generally less symmetrical and may retain portions of the original cortex. Compared to spheroids, polyhedrons are characterized by multiple intersecting flake removals, producing a distinctly angular morphology; bolas exhibit smoother and more rounded surfaces with no visible crests ([@leakey1971; @tittonSubspheroidsLithicAssemblage2020; @deweyer2017]).

Although these artifact types are frequently grouped under the category “PSB” (or “PSSB” when subspheroids are included) [BM: we should fully spell out the abbreviation at the first time we show it to the reader] and are commonly interpreted as volumetrically reduced artifacts organized around a central point, this morphology-based classification has led to several interpretive challenges. Artifacts identified as spheroids in one study may be classified as bolas or attributed to entirely different technological categories in another. Furthermore, research has shown that these forms may not represent a unified *chaîne opératoire* [BM: if we say 'research has shown', then we need to cite that research in the same sentence]. Differences in raw material selection suggest divergent technological strategies and potentially distinct functional purposes ([@deweyer2017; @jones1994]).

At present, the technological category and function of spheroids remain central topics of debate. Broadly, spheroids have been interpreted as hammerstones ([@mussi2025; @schick1994], cores ([@sahnouni1997]), or projectiles ([@leakey1979]). Closely tied to this debate is the question of their production strategy, which remains unclear. Experimental replication and site-specific diacritical analyses have produced divergent interpretations. One view suggests that spheroids emerged unintentionally as the by-products of core exhaustion, which represents a low-effort strategy aimed at flake production ([@sahnouni1997]). Another perspective holds that spheroids were naturally produced through high-intensity battering ([@schick1994]; \[\@mora2005\]; [@clark1955]). In contrast, a third view proposes that spheroids reflect a conceptual template and were produced through a deliberate shaping strategy ([@tittonSubspheroidsLithicAssemblage2020; @Muller2023; @texier2014]). [BM: yes, this is great, good job, this is a very important paragraph for the introduction of the paper. We might need to expand it a bit]

Spheroids are a widely distributed type of stone artifact, appearing across a broad temporal and geographic range—from the Oldowan and Acheulean to the Middle Paleolithic—and in diverse archaeological assemblages ([@willoughby1985; @Cabanes2024]). This wide distribution is matched by considerable technological and morphological variability, which has fueled ongoing debates concerning their methods of production and functional significance. [BM: you have already mentioned debates in the previous paragraph, so it's seems a bit odd to mention debates again here without continuity with the previous paragraph. Maybe these two sentences are better as the opening sentences for the paper, setting the scene for more information about the debates] Site-specific studies are therefore essential for reconstructing the spatial and temporal distribution of spheroids, as well as for identifying their distinct technological traits and functions. Such analyses provide a foundation for situating spheroids within broader discussions of early human technological behavior.

In this study, we analyzed material from the Middle Pleistocene Qianshangying site (QSY) in northern China. Among an assemblage previously classified as a simple core-flake industry, we identified a group of highly standardized spheroids and subspheroids. we observed notable differences between these artifacts and multifacial cores or polyhedrons, which are stone artifacts through typical flaking strategies. We proposed that their concept and manufacture reflect a distinct technological tradition, separate from conventional flake-based technology. [BM: I think it would be good to rephrase this as a question that the rest of the paper will answer, that will help to create a sense of flow for the reader.]

We conducted quantitative morphological and technological analyses, including the novel spherical harmonic analysis, on the spheroids recovered from the QSY site [BM: perhaps something like 'a novel application of spherical harmonic analysis methods to an East Asian palaeolithic assemblage']. Our goal was to evaluate whether these spheroids exhibited standardized morphology and production patterns, and whether their tendency toward spherical form resulted from deliberate and systematic reduction processes [BM: this is a very nice and clear statement of our goal, I think it might be good to put it at the second sentence of the paragraph before this one, so we state our goal, then we say how we will tackle it]. These analyses aimed to clarify the technological strategy behind spheroid production at QSY, within the broader context of Middle Pleistocene lithic practices in northern China.

# Context of QSY and its spheroids

QSY lies in the Nihewan Basin, a region in northern China situated between the Chinese Loess Plateau and the Inner Mongolian Plateau. The basin preserves extensive Quaternary fluvio-lacustrine and loess deposits ([@li2000; @yuan2009]), hosts the highest concentrations of Pleistocene Paleolithic sites in East Asia, and is especially significant for preserving evidence of early hominin activities outside Africa dating back over one million years ([@yang2020; @yang2017; @pei2019; @pei2017; @zhu2001; @zhu2004]). In recent years, nearly 20 Middle Pleistocene sites—including Jijiazhuang and Caijiagou—have been identified in the southeastern part of the basin ([@yuwei2023; @ye2024]), within the Yuxian Sub-basin, thereby completing the regional cultural sequence of the Nihewan Basin. [BM: great detail about the context, can we make a figure that includes a map and a photo of the site?]

The QSY site complex consists of four localities from QSY-A to QSY-D, discovered in 2015. It is among the region’s most artifact-rich archaeological site. Geomorphological and sedimentological evidence indicates that the stratigraphy at the site records a full cycle of lake expansion, retreat, re-expansion, and eventually disappearance of the ancient Nihewan lake, and hominin occupation occurred in a marginal lacustrine setting during a low lake-level episode [BM: citation needed]. The stratigraphic context of QSY indicates a short-term occupation resulting from a single hominin activity event. The assemblage appears to be largely in situ, exhibiting minimal disturbance after deposition and well-preserved patterns of technological combination. ESR dating of the cultural layer places hominin activity at approximately 429 ± 39 ka [BM: citation needed].

A total of 957 stone artifacts were recovered from four localities at the QSY site, with QSY-A and QSY-B yielding the most abundant assemblages. Following a widely used techno-typological framework (Isaac, 1981, 1986; de la Torre and Mora, 2005, 2018; de la Torre et al., 2011; Pei et al., 2017), the assemblage was classified into four general categories: flaked pieces (n = 247, 25.9%), detached pieces (n = 686, 71.9%), pounded pieces (n = 4, 0.4%), and unmodified materials (n = 17, 1.8%). [BM: is it possible to use inline R code for these numbers?]


# Method

In this study, the 3d models of the cores were collected and used for morphometric and technological analysis. Digital data were captured using Artec Spider, and post-processing was carried out with Artec Studio \[version number\]. The 3D scan files and all the R and Python code used in the analyses reported here are openly available online at https://doi.org/xxxx/xxxx/./xxxx/.

## Morphometric Analysis

```{r, echo=FALSE}
# 读取表格
library(tidyverse)
library(readxl)
library(here)
library(stringr)

file_path <- here("analysis/data/derived_data/core_typology_morphological_parameters.xlsx")
data_raw <- read_excel(file_path)

# 对所有字符型列进行清洗
data_clean <- data_raw |>
  mutate(across(
    where(is.character),
    ~ str_to_title(str_squish(trimws(.x)))
  ))

# 统计每类 Typology 的数量
typology_counts <- data_clean |> 
  count(Typology, sort = TRUE)

n_total_typology <- data_clean |> 
  filter(!is.na(Typology)) |> 
  nrow()

# 组合统计
group_counts <- data_clean |>
  filter(Typology %in% c("Polyhedron", "Multifacial", "Spheroid", "Subspheroid")) |>
  mutate(
    Group = case_when(
      Typology %in% c("Polyhedron", "Multifacial") ~ "Polyhedron + Multifacial",
      Typology %in% c("Spheroid", "Subspheroid") ~ "Spheroid + Subspheroid"
    )
  ) |>
  count(Group)

n_poly_multi <- group_counts$n[group_counts$Group == "Polyhedron + Multifacial"]
n_sub_spheroid <- group_counts$n[group_counts$Group == "Spheroid + Subspheroid"]


```

Based on typological study, we identify some faceted sub-spheroids/spheroids in QSY site. To minimize subjective judgment inherent in typological classifications—particularly in distinguishing spheroids from stone cores—we applied quantitative methods to evaluate the degree of difference between the archaeological spheroids and a perfect sphere. In addition to the spheroids, we included other multifacial cores and polyhedrons in the morphological study to explore whether they can be distinguished from the spheroids.

These quantitative methods included computing the sphericity index, 3D spherical harmonics, spherical harmonic energy (SHE) and the centroid offset for each artifact. We also examined the degree of standardization of the spheroids by compulating coefficients of variation [@Eerkens2001; @muller2023] of shape proxies. Furthermore, we compared the results of the typological and our new morphometric analyses to investigate the validity of the traditional typological approach.

### Sphericity index

To evaluate the degree to which the artifacts approximate a perfect sphere, this study employs a standardized sphericity index originally proposed by @Wadell1935 and later adapted for 3D digital models in geoscientific research. The index is calculated using the following formula:

$$
\Psi = \frac{\pi^{1/3} (6V)^{2/3}}{A}
$$

Where V is the volume and A is the surface area of the object. This dimensionless metric yields a maximum value of 1 for a perfect sphere. While values closer to 1 generally indicate a more spherical geometry, sphericity is calculated solely from volume and surface area. As a result, some irregular objects may exhibit high sphericity, while conversely, objects that are generally spherical in shape may deviate from ideal sphericity due to angular features or surface roughness. Thus, sphericity serves as a useful but limited proxy for assessing how close an object is to a perfect sphere. We used Python to derive surface area and volume measurements from 3D mesh models, and before that all models were decimated to a consistent face count and subjected to unit normalization to ensure comparability across artifacts.

### 3D spherical harmonics analysis

Spherical Harmonic (SPHARM) analysis is a method for describing 3D shapes using a series of mathematical functions defined on the surface of a sphere. It works like a 3D version of Fourier analysis, breaking down complex shapes into components of different spatial frequencies. Each shape is first mapped onto a unit sphere and then expressed as a combination of spherical harmonic functions $Y_l^m(\theta, \phi)$. The shape is represented by a set of coefficients $\hat{f}(l, m)$, which capture how much each function contributes. Here, θ and ϕ are angles in spherical coordinates, l and m are order and degree respectively. Lower-order terms describe the general shape, while higher-order terms capture finer details (@fig-SPHARM-Reconstruction-by-Degree).

This method is widely used in the field of biology, such as the analysis of skull morphology and cell morphology [@Link2024; @Medyukhina2020; @Harper2022; @Hewitt2024; @Grieb2022]. However, there are currently very few application of SPHARM to archaeological artifacts [@Muller2023; @Noshita2025]. Our work aims to demonstrate the usefulness of SPHARM for shape analysis of objects that are roughly spherical in shape, such as the spheroids and cores studied in this research.

We first imported, cleaned, and simplified the STL files of spheroids and cores to extract 3D mesh vertices, which were then converted from Cartesian (x, y, z) to spherical coordinates (r, θ, φ) [@Link2024; @Medyukhina2020]. Next, we interpolated radial values onto a regular spherical grid and then decomposed them using spherical harmonics based on the Driscoll–Healy sampling scheme [@Link2024; @Medyukhina2020]. The resulting coefficients were normalized for scale-invariant comparison across models.

From the normalized spherical harmonic coefficients, we computed the rotation-invariant power spectrum by summing the squared magnitudes of the coefficients at each degree. Each 3D shape is thus represented by its unique power spectrum, which serves as a multidimensional descriptor. To explore variation between models, we applied UMAP for dimensionality reduction and visualization [@Van2023].All these were conducted in python.

This study represents the first attempt in archaeology to apply SPHARM for the classification of spheroids and cores. Specifically, we included a set of standard geometric models—such as sphere, rounded cube, ellipsoid (1.2:1:0.8) and box (1.2:1:1), and disc-like (flattened, and like discoid core)—in the SPHARM analysis and UMAP. Spheroids and cores were positioned in this position based on their morphological similarity to these reference models: individuals that cluster more closely to a specific standard form exhibit corresponding shape characteristics.

### Spherical Harmonic Energy

Additionally, we computed the spherical harmonic energy (SHE), defined as the sum of squared normalized spherical harmonic coefficients for each degree. This provides a rotation-invariant measure of shape complexity across spatial frequencies. For normalized shapes, this total energy approaches 1 for a perfect sphere, while more irregular forms yield higher values.

Notably, classic sphericity metrics [@Wadell1935] exhibit critical limitations in differentiating morphotypes with equivalent surface-area-to-volume ratios. SHE overcomes this constraint through spherical harmonic decomposition of surface morphology, and this allows it to distinguish localized irregularities (like core edge or concave) from global shape deviations (e.g., elongation) – differences that classic sphericity metrics often fail to capture.

We computed the total energy at degree 20, a resolution high enough to capture surface details. Lower energy values indicate more regular or rounded surfaces, while higher values reflect more irregular or angular geometries.

### Centroid offset

We also used the distance between its centre of mass (CoM) and the centre of its bounding box (CoBB) as a measure of volumetric symmetry [@Muller2023], which was computed in python. A perfect sphere will have its CoM and CoBB perfectly aligned, resulting in a zero offset. As the object becomes more irregular or asymmetric, this offset increases. For each 3D model, the CoBB is defined as the midpoint of the maximum orthogonal dimensions—length (y), width (x), and thickness (z)—of its minimum bounding box. The CoM, which approximates the true mass center for objects made of homogeneous materials, is computed by weighting each triangular face of the mesh by its surface area and normalizing the result. The distance between CoM and CoBB, normalized by the artifact’s volume, serves as a quantitative indicator of sphericity: lower values indicate more spherical forms.

## Technological Analysis

To investigate the production strategies of spheroids in QSY, this part aims to determine whether these artifacts were intentionally shaped and whether their manufacture followed standardized procedures. Addressing this question is crucial for evaluating whether spheroids represent a distinct technological category, separate from exhausted cores.

### Diacritical analysis

We applied diacritical analysis to reconstruct the reduction sequence based on superimposition relationships among scars on spheroids [@tittonSubspheroidsLithicAssemblage2020; @Cabanes2024]. This method enables the identification of scars order, allowing us to figure out the organization of removals. All spheroids, polyhedrons and multifacial cores are included in the analysis to assess whether removals organization differs systematically within these groups.

Following the reconstruction of reduction sequences, we adopted an inductive approach to infer exploitation models of spheroids—that is, the removal patterns and associated stages employed in a spheroid. Ideally, the goal is to reconstruct the complete chaîne opératoire of spheroids—from the selection of raw material and initial blank to the final product. If consistent patterns are observed, they may indicate shared reduction schemes or conceptual templates. Furthermore, we explore whether multifacial cores and polyhedrons may represent earlier stages in spheroid reduction sequences, contributing to understanding the technological relationship between these types.

### Orientation analysis

To further investigate technological strategies, we incorporated orientation statistics as a complementary approach. This method derives from fabric analysis originally used in sedimentology and has since been adapted to study the arrangement of flake scars on lithic artifacts. We followed the protocol developed by @lin2024, extracting scar vectors from each core and calculating eigenvalues to derive the isotropic ratio and elongation ratio, these steps were finished in Geomagic Wrap, Rhino8 and R.

Results are visualized using ternary plots to compare orientation statistics between spheroids and other core types. Based on our hypothesis, if spheroids were shaped following a consistent reduction sequence, they should exhibit similar and patterned orientation results. In contrast, if they merely represented exhausted cores, the orientation patterns would appear random and highly variable, similar to those of undirected polyhedron and multifacial cores.

## Efficiency of shaping strategy

This section aims to investigate how the morphology of spheroids evolves during the reduction process. We hypothesize that, as reduction intensity increases, spheroids will progressively approximate a perfect sphere. This would indicate a high-efficiency shaping strategy, where each step is directed toward achieving a predefined morphological goal. To test this hypothesis, we established a set of quantitative indicators for reduction intensity and spheroid morphology.

### Degree of reduction

To compute the degree of reduction we collected data on three metrics: scar number, removal ratio and scar density index (SDI). We measured scar number as total number of flake scars visible on the spheroid surface. Removal ratio was calculated as 1 minus cortex ratio, where the cortex ratio represents the proportion of cortical surface area to total surface area [@Cabanes2024]. We used the removal ratio instead of the traditional cortex ratio in order to maintain a positive correlation with other reduction intensity indicators. SDI is defined as the number of flake scars divided by the total 3D surface area, the SDI serves as a robust indicator of core reduction intensity, following @clarksonMeasuringCoreReduction2013. It has been demonstrated to effectively capture the dynamic nature of the reduction process. In all three metrics, higher values represent more advanced stages of reduction. Scar counts and surface area measurements were extracted using Geomagic Wrap.

### Spheroid shape

We measured spheroid shape with four metrics: sphericity, and spherical harmonic energy (SHE), along with mean edge angle, mean surface curvature.

Higher mean edge angles suggest a more spherical geometry. Ten edge intersections were randomly sampled per spheroid. Angles were calculated following @tittonSubspheroidsLithicAssemblage2020 by constructing triangles at ridge intersections, extracting vertex coordinates in Geomagic Wrap, and computed angles from the coordinates using trigonometric functions in R.

Mean surface curvature is a proxy for surface roughness, and higher mean surface curvature indicates a smoother surface. We estimated local curvature using the k-nearest neighbors method to fit a best-fit plane at each vertex [@Muller2023]. The deviation between actual surface points and this fitted plane reflects surface roughness. The calculation steps were completed in Python.

Together, these four variables allowed us to assess whether more extensively reduced spheroids display more standardized, symmetrical, and regular morphologies—characteristics expected in deliberate shaping strategies. We conducted Spearman’s rank correlation analysis between two sets of variables—reduction intensity indicators and morphological attributes. This non-parametric method is appropriate for small sample sizes and data that do not follow a normal distribution. Spheroids and sub-spheroids from the QSY site were included in the analysis.

# Results

## Results of Morphometric analysis

```{r tbl-1, echo=FALSE}

knitr::kable(data_raw, caption = "Summary of core typology and morphological parameters.")

```

```{r, echo=FALSE}

# Groups

mean_sphericity_tbl <- data_clean |>
  filter(Typology %in% c("Polyhedron", "Multifacial", "Spheroid", "Subspheroid")) |>
  mutate(
    Group = case_when(
      Typology %in% c("Polyhedron", "Multifacial") ~ "Polyhedron + Multifacial",
      Typology %in% c("Spheroid", "Subspheroid") ~ "Spheroid + Subspheroid"
    )
  )

# Mean Sphericity

mean_sphericity_summary <- mean_sphericity_tbl |>
  group_by(Group) |>
  summarise(mean_sphericity = mean(Sphericity, na.rm = TRUE)) |>
  ungroup()


mean_sphericity_poly_multi <- mean_sphericity_summary$mean_sphericity[mean_sphericity_summary$Group == "Polyhedron + Multifacial"] |> round(3)
mean_sphericity_sub_spheroid <- mean_sphericity_summary$mean_sphericity[mean_sphericity_summary$Group == "Spheroid + Subspheroid"] |> round(3)
```

```{r, echo=FALSE}

# Mann-Whitney U test
# between sphericity_poly_multi and sphericity_sub_spheroid

group_poly_multi <- mean_sphericity_tbl$Sphericity[mean_sphericity_tbl$Group == "Polyhedron + Multifacial"]
group_sub_spheroid <- mean_sphericity_tbl$Sphericity[mean_sphericity_tbl$Group == "Spheroid + Subspheroid"]

mann_whitney_result_sphericity <- wilcox.test(group_poly_multi, group_sub_spheroid, exact = FALSE)

U_value <- mann_whitney_result_sphericity$statistic  
p_value <- mann_whitney_result_sphericity$p.value    

pretty_print_sci <- function(num) {
  sci_str <- sprintf("%.2e", num)
  parts <- strsplit(sci_str, "e")[[1]]
  base <- parts[1]
  exponent <- as.integer(parts[2])
  paste0(base, " \\times 10^{", exponent, "}")
}

p_value_Mann_sci <- pretty_print_sci(p_value)

```

```{r, echo=FALSE}

# Kruskal–Wallis test
# on sphericity among 4 core types

kruskal_result <- kruskal.test(Sphericity ~ Typology, data = data_clean)

H_value <- kruskal_result$statistic
df_kruskal <- kruskal_result$parameter
p_value_kruskal <- kruskal_result$p.value
p_value_kruskal_sci <- pretty_print_sci(p_value_kruskal)
```

```{r, include=FALSE}
# Pearson correlation test

cor_test_pearson <- cor.test(data_clean$Sphericity, data_clean$`SPHARM power`, method = "pearson")


t_value <- cor_test_pearson$statistic
df_value <- cor_test_pearson$parameter
p_value <- cor_test_pearson$p.value
correlation <- cor_test_pearson$estimate

p_value_pearson_sci <- pretty_print_sci(p_value)

# 画图
ggplot(data_clean, aes(x = Sphericity, y = `SPHARM power`)) +
  # 散点（深红色）
  geom_point(size = 3, alpha = 0.9, color = "#B22222") +
  
  # 拟合线（深蓝灰）
  geom_smooth(method = "lm", se = TRUE, color = "#1C3041", fill = "#A3B1C6", linetype = "solid") +
  
   scale_x_continuous(breaks = seq(0.4, 1.0, by = 0.04)) +

  # 自定义配色主题
  theme_minimal(base_size = 15) +
  theme(
    panel.grid.major = element_line(color = "#DDDDDD"),
    panel.grid.minor = element_blank(),
    axis.title = element_text(color = "#333333"),
    axis.text = element_text(color = "#333333")
  ) +

  # 标题与坐标轴标签
  labs(
    x = "Sphericity",
    y = "SPHARM Power"
  ) +
  annotate("text",
         x = Inf, y = Inf,
         hjust = 1.1, vjust = 1.2,
         label = paste0("r = ", round(correlation, 3),
                        "\n", "p = ", pretty_print_sci(p_value),
                        "\n", "n = ", nrow(data_clean)),
         size = 5, color = "#1C3041")
```

```{r, echo=FALSE}
# Mean SHE

mean_spharm_power_summary <- mean_sphericity_tbl |>
  group_by(Group) |>
  summarise(
    mean_spharm_power = mean(`SPHARM power`, na.rm = TRUE),
    sd_spharm_power = sd(`SPHARM power`, na.rm = TRUE)
  ) |>
  ungroup()

mean_spharm_power_poly_multi <- mean_spharm_power_summary$mean_spharm_power[mean_spharm_power_summary$Group == "Polyhedron + Multifacial"] |> round(3)
sd_spharm_power_poly_multi <- mean_spharm_power_summary$sd_spharm_power[mean_spharm_power_summary$Group == "Polyhedron + Multifacial"] |> round(3)

mean_spharm_power_sub_spheroid <- mean_spharm_power_summary$mean_spharm_power[mean_spharm_power_summary$Group == "Spheroid + Subspheroid"] |> round(3)
sd_spharm_power_sub_spheroid <- mean_spharm_power_summary$sd_spharm_power[mean_spharm_power_summary$Group == "Spheroid + Subspheroid"] |> round(3)
```

```{r, echo=FALSE}
# Kruskal–Wallis test2
# on SHE among 4 core types

kruskal_result2 <- kruskal.test(`SPHARM power` ~ Typology, data = data_clean)

H_value_kruskal2 <- kruskal_result2$statistic
df_kruskal2 <- kruskal_result2$parameter
p_value_kruskal2 <- kruskal_result2$p.value

p_value_kruskal2_sci <- pretty_print_sci(p_value_kruskal2)
```

```{r, echo=FALSE}

# CV of sphericity and SHE

group_sub_spheroids <- mean_sphericity_tbl %>% filter(Group == "Spheroid + Subspheroid")

# sphericity on spheroids
mean_sph_sub_spheroids <- mean(group_sub_spheroids$Sphericity, na.rm = TRUE)
sd_sph_sub_spheroids <- sd(group_sub_spheroids$Sphericity, na.rm = TRUE)
cv_sph_sub_spheroids <- sd_sph_sub_spheroids / 
mean_sph_sub_spheroids

# SHE on spheroids
mean_she_sub_spheroids <- mean(group_sub_spheroids$`SPHARM power`, na.rm = TRUE)
sd_she_sub_spheroids <- sd(group_sub_spheroids$`SPHARM power`, na.rm = TRUE)
cv_she_sub_spheroids <- sd_she_sub_spheroids /
mean_she_sub_spheroids


group_poly_multi <- mean_sphericity_tbl %>% filter(Group == "Polyhedron + Multifacial")

mean_sph_poly_multi <- mean(group_poly_multi$Sphericity, na.rm = TRUE)
sd_sph_poly_multi <- sd(group_poly_multi$Sphericity, na.rm = TRUE)
cv_sph_poly_multi <- sd_sph_poly_multi / mean_sph_poly_multi


mean_she_poly_multi <- mean(group_poly_multi$`SPHARM power`, na.rm = TRUE)
sd_she_poly_multi <- sd(group_poly_multi$`SPHARM power`, na.rm = TRUE)
cv_she_poly_multi <- sd_she_poly_multi / mean_she_poly_multi


```

```{r setup_umap_data, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggrepel)
library(here)

# Load data
umap_data <- read_csv(here("analysis/data/derived_data/umap_lmax20.csv"))

# Lowercase category and set factor levels
umap_data <- umap_data %>%
  mutate(category_lower = tolower(category)) %>%
  mutate(category_lower = fct_relevel(category_lower,
    "polyhedron", "multifacial", "idealmodel", "subspheroid", "spheroid"
  ))

# Set point size (highlight idealmodel)
umap_data <- umap_data %>%
  mutate(point_size = if_else(category_lower == "idealmodel", 4.5, 3))

# KMeans clustering (k=4)
set.seed(123)
kmeans_result <- kmeans(umap_data[, c("x", "y")], centers = 4)

# Add clustering results
umap_data <- umap_data %>%
  mutate(
    cluster = factor(kmeans_result$cluster),
    is_idealmodel = if_else(category_lower == "idealmodel", "yes", "no")
  )

# Save x/y limits for consistent plotting
x_limits <- range(umap_data$x)
y_limits <- range(umap_data$y)

expand_range <- function(lim, ratio) {
  range_width <- diff(lim)
  return(c(lim[1] - range_width * ratio, lim[2] + range_width * ratio))
}

# 原始坐标范围
x_limits <- range(umap_data$x)
y_limits <- range(umap_data$y)

# 分别扩展 x 和 y
x_limits_expanded <- expand_range(x_limits, 0.10)  # 横轴扩展 10%
y_limits_expanded <- expand_range(y_limits, 0.15)  # 纵轴扩展 15%

# Subset for labeling
label_data <- umap_data %>%
  filter(category_lower %in% c("idealmodel", "spheroid", "subspheroid"))
```

```{r umap_by_category, include=FALSE}
category_colors <- c(
  "idealmodel" = "black",
  "spheroid" = "red",
  "subspheroid" = "orange",
  "multifacial" = "lightgray",
  "polyhedron" = "gray40"
)

ggplot(umap_data, aes(x = x, y = y)) +
  geom_point(aes(color = category_lower, size = point_size), alpha = 0.9, shape = 16) +
  #geom_text_repel(
    #data = label_data,
    #aes(label = filename),
    #size = 3,
    #max.overlaps = 100,
    #show.legend = FALSE
  #) +
  scale_color_manual(values = category_colors, name = "Category") +
  scale_size_identity() +
  coord_cartesian(xlim = x_limits_expanded, ylim = y_limits_expanded)+ #确保范围一致
  theme_minimal(base_size = 14) +
  labs(
    x = "UMAP 1",
    y = "UMAP 2"
  ) +
  theme(
    legend.position = "non",
    # plot.title = element_text(face = "bold")
  )
```

```{r umap_by_cluster, include=FALSE}
cluster_colors <- RColorBrewer::brewer.pal(4, "Set2")

ggplot(umap_data, aes(x = x, y = y)) +
  geom_point(
    data = filter(umap_data, is_idealmodel == "no"),
    aes(color = cluster),
    alpha = 0.8,
    size = 2.5
  ) +
  geom_point(
    data = filter(umap_data, is_idealmodel == "yes"),
    aes(color = cluster),
    size = 3.5,
    show.legend = FALSE
  ) +
  stat_ellipse(
    aes(color = cluster),
    type = "norm",
    level = 0.95,
    linetype = "dashed",
    show.legend = FALSE
  ) +
  scale_color_manual(
    values = cluster_colors,
    name = "Cluster"
  ) +
  coord_cartesian(xlim = x_limits_expanded, ylim = y_limits_expanded) +  # 保证坐标一致
  theme_minimal(base_size = 14) +
  theme(legend.position = "none") +
  labs(
    x = "UMAP 1",
    y = "UMAP 2",
    #caption = "Dashed ellipses show 95% confidence intervals"
  )
```

```{r, echo=FALSE}
#| label: fig-SPHARM-Reconstruction-by-Degree
#| fig-cap: "Shape reconstruction of archaeological spheroids using SPHARM (various lmax levels)"

library(here)
knitr::include_graphics(here("analysis/paper/figures/SPHARM_reconstruction.png"))

```

```{r, echo=FALSE}
#| label: fig-UMAP-SPHARM-clusters
#| fig-cap: "UMAP plot showing distinct clusters of shapes derived from SPHARM"

library(here)
knitr::include_graphics(here("analysis/paper/figures/UMAP_SPHARM_clusters.png"))

```

```{r, echo=FALSE}
#| label: fig-UMAP-SPHARM-samples
#| fig-cap: "UMAP plot of SPHARM-derived shape features colored by types"

library(here)
knitr::include_graphics(here("analysis/paper/figures/UMAP_SPHARM_samples.png"))

```

```{r, echo=FALSE}
#| label: fig-Correlation-SPHARMpower-Sphericity
#| fig-cap: "Correlation analysis between SPHARMpower and Sphericity"

library(here)
knitr::include_graphics(here("analysis/paper/figures/Correlation_SPHARMpower_Sphericity.png"))

```

We applied spherical sphericity index, harmonics analysis, and centroid offset measurements to both the spheroids (n = `r n_total_typology`) and all other multifacial and polyhedron cores (n = `r n_poly_multi`) in the assemblage of QSY. These analyses aim to assess whether spheroids are morphologically distinct from other cores, and whether they exhibit standardized shapes—an essential criterion for evaluating the existence of deliberate shaping strategies and a goal product. In addition, we compare quantitative outcomes with traditional typological classifications to assess their consistency. We present a summary table listing each core's blank morphology and type, final morphology, and cortex coverage here in [@tbl-1].

Sphericity analysis reveals a clear difference between spheroids and multifacial cores/polyhedra. The mean sphericity of spheroids (`r mean_sphericity_sub_spheroid`) is notably higher than that of multifacial cores and polyhedron (`r mean_sphericity_poly_multi`), with a Mann-Whitney U test yielding U = `r U_value`, p = $`r p_value_Mann_sci`$. This result indicates that spheroids possess a more spherical geometry overall, supporting their typological classification.

We conducted shape analysis based on spherical harmonic decomposition, setting the maximum degree to 20 (lmax=20,@fig-SPHARM-Reconstruction-by-Degree). This choice ensures that sufficient geometric detail is captured while avoiding high-frequency noise and overfitting artifacts such as the Gibbs phenomenon. After normalization, all models have their degree 0 (l=0) coefficient set to 1, allowing for meaningful comparison across different models.

A Variance Analysis was performed on the power of each harmonic degree. The results indicate that l= 2 and l=3 exhibit the highest variance across the sample, suggesting that these low-order terms capture the most significant shape variation. Specifically, l=2 reflects global asymmetries—such as elongation or flattening—while degree 3 is more sensitive to localized features like curvature and edge protrusions.

To visualize the structure of shape variation, we applied UMAP to the normalized power spectrum. The UMAP projection reveals distinct clusters in the first two dimensions of the shape space. These clusters correspond to reference models, sphere, rounded cube, ellipsoid, box and disc-shaped core (@fig-UMAP-SPHARM-clusters). This demonstrates that these cores occupy distinguishable regions in the harmonic shape space, with proximity to the sphere or elongation/flattening along specific axes emerging as key differentiating features. Most artifacts typologically classified as spheroids or sub-spheroids were grouped into the “sphere” , “cube” and "ellipsoid" clusters, indicating their consistent, near-spherical shapes (@fig-UMAP-SPHARM-samples). However, some Multifacial cores and Polyhedron also appeared in the near-spherical region. This can be attributed to their high cortex coverage or limited flake removals, which likely preserved their originally rounded forms and led to their grouping alongside more intentionally shaped spheroids.

We then tested whether the UMAP-based groupings also correspond to differences in sphericity using a Kruskal–Wallis test, which yielded $\chi^2$ = `r round(H_value, 2)`, df = `r df_kruskal`, p = $`r p_value_kruskal_sci`$. The result shows statistically significant differences in sphericity among the shape clusters, further supporting the effectiveness of the spherical harmonic approach in capturing meaningful morphological variation (@fig-Correlation-SPHARMpower-Sphericity).

The spherical harmonic energy (SHE), a novel metric introduced herein, quantifies the geometric approximation of core morphology to an ideal sphere. Normalized SHE approaching unity indicates progressively spherical configurations, while deviations from unity reflect morphological irregularity. Our analysis demonstrates significant negative correlation between SHE and classic sphericity measures (r = `r round(correlation, 2)`, df = `r df_value`, p = $`r p_value_pearson_sci`$)), validating its efficacy as a proxy of sphericity.

Statistical comparisons reveal distinct SHE distributions between morphological classes: spheroids and sub-spheroids exhibit mean SHE = `r mean_spharm_power_sub_spheroid` (SD = `r sd_spharm_power_sub_spheroid`), whereas multifacial cores and polyhedron demonstrate significantly higher irregularity (mean SHE = `r mean_spharm_power_poly_multi`, SD = `r sd_spharm_power_poly_multi`). The Kruskal-Wallis test confirms robust inter-group divergence ($\chi^2$ = `r round(H_value_kruskal2, 2)`, df = `r df_kruskal2`, p = $`r p_value_kruskal2_sci`$), proving the distinguishability of spheroids in QSY.

The pursuit of a standardized spherical form among spheroids is further supported by our findings. Using the Coefficient of Variation (CV)—defined as the sample standard deviation divided by the sample mean—we assessed the consistency of sphericity within the spheroids. @Eerkens2001 suggested that a CV of under 1.7% (0.017) is a realistic threshold for manually-produced archaeological artifacts. Both sphericity and SHE values yielded low CVs (`r round(cv_sph_sub_spheroids, 3)` and `r round(cv_she_sub_spheroids, 3)`, respectively), indicating that sub/spheroids maintain a highly standardized rounded shape. In contrast, multifacial cores combined with polyhedron has a higher CV of `r round(cv_sph_poly_multi, 3)` and `r round(cv_she_poly_multi, 3)` respectively.

## Results of technological analysis

The diacritical analysis of spheroid surfaces reveals a structured and recurrent reduction sequence comprising the following phases (@fig-spheroids-2797-1098). Phase 1 was a unidirectional or bidirectional total exploitation, belonging to one kind of volume exploitation. Large and flat surfaces of the cobble were selected as platforms for striking toward the opposite surface. Knapping proceeded until the peripheral volume was fully exploited, resulting in an approximately cubic form. Phase 2 was peripheral centripetal exploitation. In this phase, previous removals in phase 1 serve as platforms for centripetal flaking around the core periphery. This represents a surface exploitation strategy. A notable feature is the angle between the face's ventral surface and platform (i.e. core edge angle), which often exceeds 90°, forming a secant plan \[citation\] rather than parallel plan. This phase contributes significantly to the increasingly spherical shape of the artefact. Phase 3 was the production of small scars on ridges or intersections of previous flake scars, resulting in a rounding and smoother surface, further enhancing sphericality. It is important to note that due to the high degree of reduction intensity observed in most spheroids, phases prior to the visible sequence were often obliterated. We hypothesize the existence of a Phase 0, potentially involving roughing-out of the cobble or an earlier cycle of Phases 1–3.

<!-- insert QSYA-1098-4.png and QSYA-2797-0.png about here, with the texure paired with the phase annotations figures, like a 2x2 panel, add a legend to indicate the meaning of the colours -->

Scar orientation analysis further supports the interpretation of a systematic reduction sequence in the production of QSY spheroids. @fig-benn-ternary-plot shows that spheroids tend to cluster together, with elongation ratios ranging from 0.403 to 0.637 and isotropy ratios from 0.164 to 0.497. These elongation ratios suggest that the spheroids underwent unidirectional or bidirectional total exploitation, typical of Phase 1, resulting in relatively high elongation values. In addition, the peripheral centripetal exploitation, namely Phase 2, appears to have contributed to a certain degree of isotropy in scar arrangement—higher isotropy ratios are associated with more spherical shapes. Subspheroids exhibit greater variability in both elongation and isotropy ratios, indicating less consistent reduction intensity.

Multifacial cores and polyhedrons display a wide and dispersed distribution in the ternary plot, without forming any distinctive cluster. Their scar patterns show considerable variability in both elongation and isotropy, reinforcing the interpretation that these cores lack removal organization and reflect a SSDA. Multifacial cores typically exploit natural angles with core rotation occurring without a predetermined plan, which belongs to an opportunistic flaking strategy, while polyhedrons—despite showing a higher degree of reduction—follow a similarly unstructured sequence. This distinction highlights the fundamental technological difference between polyhedrons and spheroids at QSY, where they used to be considered as a continuous reduction process: polyhedrons represent exhausted cores, whereas spheroids reflect the presence of a conceptual template and systematic reduction plan.

```{r, echo = FALSE}
get_coordinates <- function(filename) {
  temp_file <- readLines(filename, encoding = "UTF-8")  # 强制 UTF-8 编码读取
  xyz1 <- data.frame(X1 = numeric(), Y1 = numeric(), Z1 = numeric())
  xyz2 <- data.frame(X2 = numeric(), Y2 = numeric(), Z2 = numeric())
  
  for (line in temp_file) {
    if (grepl("^\\s*start\\s*=", line)) {
      coordinates <- gsub(".*\\(([^()]*)\\).*", "\\1", line)
      coords <- as.numeric(strsplit(coordinates, ",")[[1]])
      xyz1 <- rbind(xyz1, data.frame(X1 = coords[1], Y1 = coords[2], Z1 = coords[3]))
    }
    if (grepl("^\\s*end\\s*=", line)) {
      coordinates <- gsub(".*\\(([^()]*)\\).*", "\\1", line)
      coords <- as.numeric(strsplit(coordinates, ",")[[1]])
      xyz2 <- rbind(xyz2, data.frame(X2 = coords[1], Y2 = coords[2], Z2 = coords[3]))
    }
  }

  # 检查是否有数据
  if (nrow(xyz1) == 0 || nrow(xyz2) == 0) {
    warning("未能提取任何坐标，返回空 data.frame")
    return(data.frame())
  }

  # 合并 + 添加 ID、类型、长度等字段
  xyz <- round(cbind(xyz1, xyz2), 5)
  filename_base <- basename(filename)  # 提取文件名
  xyz$ID <- sub("_(.*)", "", filename_base)  # 提取下划线前的部分
  xyz$type <- sub(".*_(.*)\\.txt", "\\1", filename_base)  # 提取下划线后、.txt 前的部分
  xyz$length <- sqrt((xyz$X2 - xyz$X1)^2 + (xyz$Y2 - xyz$Y1)^2 + (xyz$Z2 - xyz$Z1)^2)
  xyz$length_scaled <- xyz$length / sum(xyz$length)

  xyz <- xyz %>%
    filter(complete.cases(.)) %>%
    distinct(.keep_all = TRUE)
  
  return(xyz)
}

# 遍历文件夹中的文本文件
folder_path <- here("analysis/data/raw_data/QSY_A")
temp_file_list <- list.files(folder_path, pattern = "\\.txt$")  # 只列出 .txt 文件

std <- list()

# 读取所有文件并提取数据
for (i in seq_along(temp_file_list)) {
  filepath <- file.path(folder_path, temp_file_list[i])
  std[[i]] <- get_coordinates(filepath)
}

# 运行 benn 函数并构建数据框
benn.output <- as.data.frame(t(sapply(std, benn, min_sample = 0)))
benn.output$type <- sapply(std, function(x) if ("type" %in% names(x)) x$type[1] else NA)
benn.output$ID <- sapply(std, function(x) if ("ID" %in% names(x)) x$ID[1] else NA)
colnames(benn.output) <- c('Scar_count', 'E1', 'E2', 'E3', 'IS', 'EL', 'type', 'ID')

# 检查结果
# print(head(benn.output))

# 保存为 CSV
write.csv(benn.output,
          here("analysis/data/derived_data/benn_output.csv"), row.names = FALSE)
```

```{r, echo=FALSE}
#| label: fig-benn-ternary-plot
#| fig-cap: "Ternary plot showing flake scar orientation analysis"

benn.output$Z <- 1 - benn.output$EL - benn.output$IS

n  = 11      # Number of Data Points
nv = 0.06    # Vertical Adjustment
pn = position_nudge_tern(y = nv, x = nv, z = -nv / 2)

ggtern(data = benn.output, aes(Z, IS, EL, color = type)) + 
  geom_mask() + 
  geom_point(size = 3) + 
  theme_bw() +
  labs(
    x = "Planar", 
    y = "Isotropic", 
    yarrow = "Isotropy Ratio", 
    z = "Linear", 
    zarrow = "Elongation Ratio"
  ) +
  theme_showarrows() + 
  theme_clockwise() + 
  #geom_text(position = pn, aes(label = type), check_overlap = FALSE, size = 3) +
  scale_color_manual(values = c(
    "multifacial" = "lightgray",
    "polyhedron" = "gray40",
    "subspheroid" = "orange",
    "spheroid" = "red"
  ))

ggsave(here("analysis/paper/figures/benn_ternary_plot.jpg"), 
       width = 8, 
       height = 6, 
       dpi = 300)

```

```{r, echo=FALSE}
#| label: fig-spheroids-2797-1098
#| fig-cap: "Diacritical analysis of QSY spheroids"

library(here)
knitr::include_graphics(here("analysis/paper/figures/spheroids_2797_1098.png"))

```

```{r, echo=FALSE}
#| label: fig-shaping-process
#| fig-cap: "hypothesis of QSY spheroid shaping process"

library(here)
knitr::include_graphics(here("analysis/paper/figures/shaping_process.png"))

```

Based on this diacritical analysis and scar orientation analysis, we can summarize the technical strategy employed in the production of faceted spheroids in QSY. This strategy consists of a series of sequential phases (@fig-shaping-process): a potential rough-out phase, volume exploitation aimed at forming a cubic shape, surface exploitation to approximate a spheroidal geometry, edge refinement, and potentially the repetition of earlier phases. The existence of a repetitive phase is supported by the observation that while the original cobble blanks in QSY display considerable size variation, the finished spheroids—although some are relatively large—mostly cluster around a diameter of 8–10 cm. This suggests that the production of spheroids may have involved multiple cycles of reduction, and further implies that a diameter of 8–10 cm was considered an optimal or intended size in the knapping process. <!-- BM: maybe move to discussion -->

<!-- consider to add a visualisation, such as a histogram of the diameter, to support this claim, maybe above we can have a panel of plots of several basic attributes just to introduce the assemblages to the reader, then refer to it here. Maybe also some representative photos-->

## Efficiency of shaping strategy

```{r tbl-2, echo=FALSE}

file_path <- here("analysis/data/derived_data/flaking_intensity_and_shape.xlsx")
data_raw2 <- 
  read_excel(file_path) %>% 
  drop_na() %>% 
  mutate(across(where(is.numeric), \(x) round(x, 3)))

knitr::kable(data_raw2, caption = "Summary of spheroid shaping intensity and shape features.")

```

```{r, echo=FALSE}
#| label: fig-spearman-correlation-matrix
#| fig-cap: "Spearman correlation matrix of shape variables. Red star indicates p < 0.05"

# 加载必要包
library(readxl)
library(Hmisc)       # 用于计算相关系数和p值
library(ggcorrplot)  # 用于相关性热图绘制
library(reshape2)

file_path <- here("analysis/data/derived_data/flaking_intensity_and_shape.xlsx")
data <- read_excel(file_path)

# 标准化列名
colnames(data) <- make.names(colnames(data))

# 选定分析的列
selected_names <- c("Scar.number", "Removal.ratio", "SDI",
                    "Edge.angle.mean", "Curvature", "Sphericity", "SPHARM.power")

# 只选取实际存在于数据中的列
selected_cols <- data[, selected_names[selected_names %in% colnames(data)]]

# 显示维度和列名确认
# print(dim(selected_cols))
# print(colnames(selected_cols))

# 计算 Spearman 相关系数和对应的 p 值
rcorr_result <- rcorr(as.matrix(selected_cols), type = "spearman")
cor_matrix <- rcorr_result$r
p_matrix <- rcorr_result$P



# 转换成长格式
cor_long <- reshape2::melt(cor_matrix)
p_long <- reshape2::melt(p_matrix)

labels_long <- merge(cor_long, p_long, by = c("Var1", "Var2"))
colnames(labels_long) <- c("Var1", "Var2", "cor", "p")

# 调整因子顺序（让 y 轴从上往下）
labels_long$Var1 <- factor(labels_long$Var1, levels = rev(rownames(cor_matrix)))
labels_long$Var2 <- factor(labels_long$Var2, levels = colnames(cor_matrix))

# 显著标记星号
labels_long$star <- ifelse(labels_long$p < 0.05 & labels_long$Var1 != labels_long$Var2, "*", "")

# 相关系数文本，保留2位小数
labels_long$cor_label <- sprintf("%.2f", labels_long$cor)


val1 <- labels_long[labels_long$Var1 == "Scar.number" & labels_long$Var2 == "Removal.ratio", ]
cor_scar_removal <- sprintf("%.2f", val1$cor)
p_scar_removal <- pretty_print_sci(val1$p)

# 提取 scar number ~ SDI
val2 <- labels_long[labels_long$Var1 == "Scar.number" & labels_long$Var2 == "SDI", ]
cor_scar_sdi <- sprintf("%.2f", val2$cor)
p_scar_sdi <- pretty_print_sci(val2$p)

# 提取 removal ratio ~ SDI
val3 <- labels_long[labels_long$Var1 == "Removal.ratio" & labels_long$Var2 == "SDI", ]
cor_removal_sdi <- sprintf("%.2f", val3$cor)
p_removal_sdi <- pretty_print_sci(val3$p)

# 提取 edge angle ~ sphericity
val4 <- labels_long[labels_long$Var1 == "Edge.angle.mean" & labels_long$Var2 == "Sphericity", ]
cor_angle_sph <- sprintf("%.2f", val4$cor)
p_angle_sph <- pretty_print_sci(val4$p)

# 提取 edge angle ~ SPHARM power
val5 <- labels_long[labels_long$Var1 == "Edge.angle.mean" & labels_long$Var2 == "SPHARM.power", ]
cor_angle_she <- sprintf("%.2f", val5$cor)
p_angle_she <- pretty_print_sci(val5$p)

# 提取 curvature ~ Sphericity
val6 <- labels_long[labels_long$Var1 == "Curvature" & labels_long$Var2 == "Sphercity", ]
cor_cur_sph <- sprintf("%.2f", val5$cor)
p_cur_sph <- pretty_print_sci(val5$p)

# 自己绘图
ggplot(labels_long, aes(x = Var2, y = Var1, fill = cor)) +
  geom_tile(color = "gray") +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  geom_text(aes(label = cor_label), size = 3) +          
# 相关系数字符串
  geom_text(aes(label = star), color = "red", size = 6, nudge_y = 0.25) + # 星号
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(fill = "Correlation",
       x = "",
       y = "") 
  
```

@fig-spearman-correlation-matrix shows significant positive correlations among the three variables representing reduction intensity: scar number, removal ratio, and SDI. Among them, scar counts show significant positive correlations with both removal ratio (ρ = `r cor_scar_removal`, p = $`r p_scar_removal`$) and SDI (ρ = `r cor_scar_sdi`, p = $`r p_scar_sdi`$). Removal ratio and SDI exhibit a stronger and more highly significant correlation (ρ = `r cor_removal_sdi`, p = $`r p_removal_sdi`$). These two variables incorporate surface area in their calculation, making them more effective in capturing the density and intensity of reduction, and therefore more reliable indicators of the shaping process in spheroids.

Among the shape descriptors of spheroids, several significant correlations were observed. Mean edge angle was positively correlated with sphericity (ρ = `r cor_angle_sph`, p = $`r p_angle_sph`$) and negatively correlated with SPHARM power (ρ = `r cor_angle_she`, p = $`r p_angle_she`$), indicating that greater edge angles are associated with more spherical and regular forms. As noted in previous studies, mean edge angle is a key variable in capturing the morphology of spheroids \[citation\]. This correlation between edge angle and sphericity may help explain why spheroids were often interpreted as exhausted cores in earlier research \[citation\]. Indeed, spheroids must be significantly reduced, as achieving a near-perfect spherical shape typically results in increased edge angles, making further flake removal difficult. However, the reverse is not necessarily true—not all exhausted cores evolve into spheroids.

Curvature was only significantly correlated with sphericity (ρ = `r cor_cur_sph`, p = $`r p_cur_sph`$), suggesting that smoother surfaces tend to approximate spheres more closely. Its lack of correlation with other variables may reflect its focus on local surface texture, while edge angle and SPHARM power capture broader aspects of shape regularity and symmetry. The weak correlation between sphericity and SPHARM power may result from the small sample size or their different sensitivities: sphericity, based on area and volume, tolerates surface variation, while SPHARM power responds more to asymmetry and surface irregularity. Thus, even in similarly spherical specimens, surface differences can produce substantial variation in SPHARM power. The analysis of spheroid shape variables indicates that mean edge angle, curvature, sphericity, and SPHARM power each capture distinct aspects of spheroid morphology, which explains the varying strengths of correlation observed among them.

# Discussion

# Conclusion

# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

# References

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r}
#| label: colophon
#| cache: false

# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
