---
format: gfm
default-image-extension: ""
---

<!-- README.md is generated from README.qmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# Spherical harmonic analysis of faceted spheroids identifies shaping strategies and standardisation at Qianshangying (North China)

<!--
[![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/benmarwick/archyjobads/main?urlpath=rstudio) [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.15847809.svg)](https://doi.org/10.5281/zenodo.15847809)
-->

This repository contains the data and code for our paper:

> Ye Zhi, Ben Marwick, Li Hao, Shuwen Pei (2025). Spherical harmonic analysis of faceted spheroids identifies shaping strategies and standardisation at Qianshangying (North China)". Submitted to _Journal of Archaeological Science_

A pre-print of this paper is freely available on SocArXiv: https://osf.io/preprints/socarxiv/

## Contents

The **analysis** directory contains:

  - [:file\_folder: paper](/analysis/paper): Quarto source document for manuscript. Includes code to reproduce the figures and tables
    generated by the analysis. 
  - [:file\_folder: data](/analysis/data): Data used in the analysis.
  - [:file\_folder: figures](/analysis/paper/figures): Plots and other
    illustrations
  - [:file_folder: py_SPHARM](/py_SPHARM): Python source files for SPHARM analysis.  
    - **SPHARM_main**:  
        - `batch_operation.py` — batch calculation of spherical harmonics for STL files.  
        - `main.py` — shape analysis using spherical harmonics for a single STL file, including visualization of analysis results.  
    - **SPHARM_modules**: supporting modules for main scripts, including shape preprocessing, spherical harmonic computation/statistics, shape reconstruction, and computation/output of sphericity and curvature.
    
    
## How to run the code in your browser

You can run the R code in this project without downloading or installing anything. Click [here](https://mybinder.org/v2/gh/zhiye0927/QSY-Spheroids-Study/main?urlpath=rstudio) to open a Binder instance with RStudio running in your web broswer. Then follow the instructions below as if you were running RStudio locally on your computer (open the `.Rproj` file in RStudio, etc.). 

## How to download and run locally

This research compendium has been developed using the statistical programming
language R. To work with the compendium, you will need
installed on your computer the [R software](https://cloud.r-project.org/)
itself and optionally [RStudio Desktop](https://rstudio.com/products/rstudio/download/).

You can download the compendium as a zip from from this URL:
[master.zip](/archive/master.zip). After unzipping:     
- open the `.Rproj` file in RStudio     
- run `renv::restore()` to ensure you have the packages this analysis depends on     
- finally, open `analysis/paper/article.qmd` and render to produce the `article.docx`, or run `rmarkdown::render("analysis/paper/paper.qmd")` in the R console 

## How to download and run locally in a Docker container

This research compendium includes a [Dockerfile](Dockerfile) that
specifies the computational environment used to generate the results
presented in the paper. You can recreate this environment, which
includes R, RStudio and all necessary R packages, on your computer by
following these steps:

1.  Install [Docker](https://www.docker.com/get-started/) on your
    computer
2.  Download the compendium, e.g. from GitHub by clicking on the green
    `< > Code` button above, then click `Download ZIP`, then unzip on
    your computer
3.  Set your terminal working directory to the compendium, and run
    `docker build -t qsy .` (be sure to include the period) to build 
    the container on your computer, it will take a few minutes and require 
    a fast internet connection.
4.  Run in your terminal
    `docker run --rm -it -e ROOT=TRUE -e PASSWORD=rstudio -dp 8787:8787 qsy`
    to start the container on your computer
5.  Go to <http://localhost:8787/> with your browser and enter `rstudio`
    in both fields to start RStudio in your browser, running in the
    Docker container with all the required depedencies installed
6.  In RStudio, run
    `rstudioapi::openProject("/home/rstudio/qsy")`
    to open the compendium’s project. This project uses
    [`renv`](https://rstudio.github.io/renv/) to document and manage
    dependencies, this will be activated when the project is first
    opened in RStudio.
7.  Run
    `rmarkdown::render("analysis/paper/paper.qmd", output_dir='/tmp')`
    to render the Quarto document that is the manuscript submitted for
    publication
8.  After the code has executed, view the rendered output document by
    running `browseURL("/tmp/paper.docx")`
9.  When finished, to delete the Docker container from your computer,
    run this in the terminal on your desktop:
    `docker ps -aq | xargs docker stop | xargs docker rm`


### Licenses

**Text and figures :**  [CC-BY-4.0](http://creativecommons.org/licenses/by/4.0/)

**Code :** See the [DESCRIPTION](DESCRIPTION) file

**Data :** [CC-0](http://creativecommons.org/publicdomain/zero/1.0/) attribution requested in reuse


